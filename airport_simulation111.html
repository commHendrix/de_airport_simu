<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºåœºèˆªç­ä»¿çœŸç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .control-panel {
            background: #f8fafc;
            padding: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .control-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .time-display {
            font-size: 1.5em;
            font-weight: bold;
            color: #1f2937;
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #e0f2fe, #b3e5fc);
            border-radius: 10px;
        }
        
        .airports-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            padding: 30px;
        }
        
        .airport-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .airport-card:hover {
            transform: translateY(-5px);
        }
        
        .airport-header {
            padding: 20px;
            color: white;
            text-align: center;
            font-weight: bold;
            font-size: 1.3em;
        }
        
        .airport-A .airport-header { background: linear-gradient(135deg, #e11d48, #be185d); }
        .airport-B .airport-header { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .airport-C .airport-header { background: linear-gradient(135deg, #10b981, #059669); }
        .airport-D .airport-header { background: linear-gradient(135deg, #f59e0b, #d97706); }
        
        .flight-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
        }
        
        .flight-item {
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            margin-bottom: 12px;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .flight-item:hover {
            background: #e0f2fe;
            transform: translateX(5px);
        }
        
        .flight-item.delayed {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        
        .flight-number {
            font-weight: bold;
            color: #1f2937;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .route {
            color: #6b7280;
            margin-bottom: 5px;
        }
        
        .time-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }
        
        .departure-time, .arrival-time {
            font-weight: 600;
        }
        
        .gate {
            background: #3b82f6;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .status-normal { background: #dcfce7; color: #166534; }
        .status-delayed { background: #fee2e2; color: #991b1b; }
        .status-weather { background: #fef3c7; color: #92400e; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 90%;
        }
        
        .modal h3 {
            margin-bottom: 20px;
            color: #1f2937;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }
        
        .form-group select, .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .form-group select:focus, .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }
        
        .close:hover {
            color: #ef4444;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1âœˆï¸ æœºåœºèˆªç­ä»¿çœŸç³»ç»Ÿ</h1>
            <p>å®æ—¶èˆªç­ç›‘æ§ä¸å¼‚å¸¸å¤„ç†ç³»ç»Ÿ</p>
        </div>
        
        <div class="control-panel">
            <div class="control-buttons">
                <button class="btn btn-primary" onclick="startSimulation()">å¼€å§‹ä»¿çœŸ</button>
                <button class="btn btn-warning" onclick="pauseSimulation()">æš‚åœä»¿çœŸ</button>
                <button class="btn btn-success" onclick="resetSimulation()">é‡ç½®ç³»ç»Ÿ</button>
                <button class="btn btn-danger" onclick="showAirModal()">èˆªè·¯æ‹¥å µ</button>
                <button class="btn btn-danger" onclick="showWeatherModal()">å¤©æ°”å¼‚å¸¸</button>
                <button class="btn btn-danger" onclick="showCompanyModal()">èˆªå¸é—®é¢˜</button>
            </div>
            
            <div class="time-display" id="currentTime">
                å½“å‰ä»¿çœŸæ—¶é—´: 06:00
            </div>
        </div>
        
        <div class="airports-container">
            <div class="airport-card airport-A">
                <div class="airport-header">
                    ğŸ¢ Aæœºåœº (3ä¸ªèˆªç«™æ¥¼ - T3R3)
                </div>
                <div class="flight-list" id="airport-A">
                    <div class="loading">æ­£åœ¨åŠ è½½èˆªç­ä¿¡æ¯...</div>
                </div>
            </div>
            
            <div class="airport-card airport-B">
                <div class="airport-header">
                    ğŸ¢ Bæœºåœº (2ä¸ªèˆªç«™æ¥¼ - T2R2)
                </div>
                <div class="flight-list" id="airport-B">
                    <div class="loading">æ­£åœ¨åŠ è½½èˆªç­ä¿¡æ¯...</div>
                </div>
            </div>
            
            <div class="airport-card airport-C">
                <div class="airport-header">
                    ğŸ¢ Cæœºåœº (2ä¸ªèˆªç«™æ¥¼ - T2R2)
                </div>
                <div class="flight-list" id="airport-C">
                    <div class="loading">æ­£åœ¨åŠ è½½èˆªç­ä¿¡æ¯...</div>
                </div>
            </div>
            
            <div class="airport-card airport-D">
                <div class="airport-header">
                    ğŸ¢ Dæœºåœº (1ä¸ªèˆªç«™æ¥¼ - T1R1)
                </div>
                <div class="flight-list" id="airport-D">
                    <div class="loading">æ­£åœ¨åŠ è½½èˆªç­ä¿¡æ¯...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¼‚å¸¸å¤„ç†æ¨¡æ€æ¡† -->
    <div id="airModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('airModal')">&times;</span>
            <h3>ğŸš« èˆªè·¯æ‹¥å µå¼‚å¸¸</h3>
            <div class="form-group">
                <label>é€‰æ‹©å—å½±å“æœºåœº:</label>
                <select id="airAirport">
                    <option value="A">Aæœºåœº</option>
                    <option value="B">Bæœºåœº</option>
                    <option value="C">Cæœºåœº</option>
                    <option value="D">Dæœºåœº</option>
                </select>
            </div>
            <button class="btn btn-danger" onclick="triggerAirCongestion()">è§¦å‘èˆªè·¯æ‹¥å µ</button>
        </div>
    </div>
    
    <div id="weatherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('weatherModal')">&times;</span>
            <h3>ğŸŒ§ï¸ å¤©æ°”å¼‚å¸¸</h3>
            <div class="form-group">
                <label>é€‰æ‹©å—å½±å“æœºåœº:</label>
                <select id="weatherAirport">
                    <option value="A">Aæœºåœº</option>
                    <option value="B">Bæœºåœº</option>
                    <option value="C">Cæœºåœº</option>
                    <option value="D">Dæœºåœº</option>
                </select>
            </div>
            <button class="btn btn-danger" onclick="triggerWeatherDelay()">è§¦å‘å¤©æ°”å¼‚å¸¸</button>
        </div>
    </div>
    
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('companyModal')">&times;</span>
            <h3>ğŸ¢ èˆªå¸é—®é¢˜</h3>
            <div class="form-group">
                <label>é€‰æ‹©å—å½±å“èˆªç­:</label>
                <select id="companyFlight">
                    <!-- åŠ¨æ€å¡«å…… -->
                </select>
            </div>
            <button class="btn btn-danger" onclick="triggerCompanyDelay()">è§¦å‘èˆªå¸é—®é¢˜</button>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentTime = 360; // 6:00 AM in minutes
        let isSimulationRunning = false;
        let simulationInterval = null;
        let flights = [];
        let airportCapacity = { A: 3, B: 2, C: 2, D: 1 };
        let gateUsage = { A: [], B: [], C: [], D: [] };
        let weatherDelays = {};
        
        // åˆå§‹åŒ–ç™»æœºå£
        function initializeGates() {
            for (let airport in gateUsage) {
                gateUsage[airport] = Array(15).fill(null);
            }
        }
        
        // åˆ†é…ç™»æœºå£
        function assignGate(airport) {
            for (let i = 0; i < gateUsage[airport].length; i++) {
                if (gateUsage[airport][i] === null) {
                    gateUsage[airport][i] = true;
                    return i + 1;
                }
            }
            return Math.floor(Math.random() * 15) + 1; // å¦‚æœæ²¡æœ‰ç©ºé—²ç™»æœºå£ï¼Œéšæœºåˆ†é…
        }
        
        // é‡Šæ”¾ç™»æœºå£
        function releaseGate(airport, gate) {
            if (gate && gate <= 15) {
                gateUsage[airport][gate - 1] = null;
            }
        }
        
        // åˆ›å»ºåŸºç¡€èˆªç­æ•°æ®
        function createBaseFlights() {
            // åŸå§‹æŒ‡å®šçš„èˆªçº¿
            const originalRoutes = [
                { code: 'SYSU01', route: ['A', 'B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU02', route: ['B', 'A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU03', route: ['C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU04', route: ['D', 'A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU05', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU06', route: ['A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU07', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU08', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU09', route: ['C', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU10', route: ['B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU11', route: ['B', 'A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU12', route: ['B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }
            ];
            
            // æ™ºèƒ½è¡¥å……çš„èˆªçº¿ï¼ˆä¿è¯å››åœ°äº’é€šï¼‰
            const additionalRoutes = [
                // ç›´é£èˆªçº¿è¡¥å……
                { code: 'SYSU13', route: ['A', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU14', route: ['C', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU15', route: ['B', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU16', route: ['D', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU17', route: ['D', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU18', route: ['C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // ä¸­è½¬èˆªçº¿è¡¥å……
                { code: 'SYSU19', route: ['A', 'C', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU20', route: ['B', 'C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU21', route: ['C', 'A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU22', route: ['D', 'A', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU23', route: ['C', 'B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU24', route: ['A', 'B', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // ç¯çº¿èˆªçº¿
                { code: 'SYSU25', route: ['A', 'B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU26', route: ['B', 'C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU27', route: ['C', 'A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU28', route: ['D', 'A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // ç™½å¤©é«˜é¢‘èˆªçº¿
                { code: 'SYSU29', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU30', route: ['B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU31', route: ['A', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU32', route: ['C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU33', route: ['A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU34', route: ['D', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU35', route: ['B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU36', route: ['C', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // å¤œé—´èˆªçº¿ï¼ˆ22:00-06:00ï¼‰
                { code: 'SYSU37', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] }, // å¤œé—´å•†åŠ¡çº¿
                { code: 'SYSU38', route: ['B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU39', route: ['A', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }, // å¤œé—´å¹²çº¿
                { code: 'SYSU40', route: ['C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU41', route: ['A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] }, // å¤œé—´å¿«çº¿
                { code: 'SYSU42', route: ['D', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // çº¢çœ¼èˆªç­ï¼ˆ00:00-06:00ï¼‰
                { code: 'SYSU43', route: ['B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }, // çº¢çœ¼è´§è¿çº¿
                { code: 'SYSU44', route: ['C', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU45', route: ['B', 'D'], series: ['SYSU', 'SSSE', 'OVO'] }, // çº¢çœ¼è¿æ¥çº¿
                { code: 'SYSU46', route: ['D', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU47', route: ['C', 'D'], series: ['SYSU', 'SSSE', 'OVO'] }, // çº¢çœ¼æ”¯çº¿
                { code: 'SYSU48', route: ['D', 'C'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // å‡Œæ™¨èˆªçº¿ï¼ˆ03:00-05:30ï¼‰
                { code: 'SYSU49', route: ['A', 'B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }, // å‡Œæ™¨ä¸­è½¬
                { code: 'SYSU50', route: ['C', 'B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU51', route: ['B', 'A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] }, // å‡Œæ™¨å¿«é€’
                { code: 'SYSU52', route: ['D', 'A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // æ—©ç­åŠ å¯†èˆªçº¿ï¼ˆ05:30-08:00ï¼‰
                { code: 'SYSU53', route: ['A', 'B'], series: ['SYSU', 'SSSE', 'OVO'] }, // æ—©ç­é€šå‹¤
                { code: 'SYSU54', route: ['B', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU55', route: ['A', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }, // æ—©ç­å•†åŠ¡
                { code: 'SYSU56', route: ['C', 'A'], series: ['SYSU', 'SSSE', 'OVO'] },
                { code: 'SYSU57', route: ['B', 'C'], series: ['SYSU', 'SSSE', 'OVO'] }, // æ—©ç­æ¥é©³
                { code: 'SYSU58', route: ['C', 'B'], series: ['SYSU', 'SSSE', 'OVO'] },
                
                // æ·±å¤œè´§è¿ä¸“çº¿ï¼ˆ01:00-04:00ï¼‰
                { code: 'SYSU59', route: ['A', 'D'], series: ['SYSU', 'SSSE', 'OVO'] }, // æ·±å¤œè´§è¿
                { code: 'SYSU60', route: ['D', 'A'], series: ['SYSU', 'SSSE', 'OVO'] }
            ];
            
            const allRoutes = [...originalRoutes, ...additionalRoutes];
            
            flights = [];
            let flightId = 0;
            let timeSlots = generateTimeSlots(); // ç”Ÿæˆæ—¶é—´æ®µ
            let slotIndex = 0;
            
            allRoutes.forEach(baseRoute => {
                baseRoute.series.forEach(series => {
                    const flightCode = baseRoute.code.replace('SYSU', series);
                    
                    // åˆ†é…æ—¶é—´æ®µ
                    const departureTime = timeSlots[slotIndex % timeSlots.length];
                    slotIndex++;
                    
                    // å‰ç¨‹èˆªç­
                    const outboundFlight = {
                        id: flightId++,
                        flightNumber: flightCode,
                        route: [...baseRoute.route],
                        currentSegment: 0,
                        departureTime: departureTime,
                        arrivalTime: calculateArrivalTime(departureTime, baseRoute.route),
                        status: 'scheduled',
                        gate: null,
                        delay: 0,
                        isReturn: false
                    };
                    
                    // è®¡ç®—è¿”ç¨‹æ—¶é—´
                    const returnDepartureTime = outboundFlight.arrivalTime + 100; // 100åˆ†é’Ÿé—´éš”
                    const returnRoute = [...baseRoute.route].reverse();
                    
                    // è¿”ç¨‹èˆªç­
                    const returnFlight = {
                        id: flightId++,
                        flightNumber: flightCode + 'R',
                        route: returnRoute,
                        currentSegment: 0,
                        departureTime: returnDepartureTime,
                        arrivalTime: calculateArrivalTime(returnDepartureTime, returnRoute),
                        status: 'scheduled',
                        gate: null,
                        delay: 0,
                        isReturn: true
                    };
                    
                    flights.push(outboundFlight, returnFlight);
                });
            });
            
            // æŒ‰èµ·é£æ—¶é—´æ’åº
            flights.sort((a, b) => a.departureTime - b.departureTime);
        }
        
        // ç”Ÿæˆåˆç†çš„æ—¶é—´æ®µåˆ†é…
        function generateTimeSlots() {
            const slots = [];
            
            // æ—©ç­èˆªçº¿ (5:30-9:00) - å¯†é›†å‘ç­
            for (let hour = 5; hour <= 9; hour++) {
                const startMin = hour === 5 ? 30 : 0;
                for (let min = startMin; min < 60; min += 12) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // ä¸Šåˆèˆªçº¿ (9:00-12:00) - å•†åŠ¡é«˜å³°
            for (let hour = 9; hour <= 12; hour++) {
                for (let min = 0; min < 60; min += 15) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // ä¸‹åˆèˆªçº¿ (12:00-18:00) - å…¨å¤©ä¸»åŠ›
            for (let hour = 12; hour <= 18; hour++) {
                for (let min = 0; min < 60; min += 10) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // æ™šç­èˆªçº¿ (18:00-22:00) - ä¸‹ç­é«˜å³°
            for (let hour = 18; hour <= 22; hour++) {
                for (let min = 0; min < 60; min += 18) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // å¤œç­èˆªçº¿ (22:00-01:00) - å¤œé—´æœåŠ¡
            for (let hour = 22; hour <= 24; hour++) {
                for (let min = 0; min < 60; min += 25) {
                    if (hour === 24 && min > 0) break; // é¿å…è¶…è¿‡24:00
                    slots.push(hour === 24 ? min : hour * 60 + min);
                }
            }
            
            // æ·±å¤œèˆªçº¿ (01:00-03:00) - çº¢çœ¼èˆªç­
            for (let hour = 1; hour <= 3; hour++) {
                for (let min = 0; min < 60; min += 35) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // å‡Œæ™¨èˆªçº¿ (03:00-05:30) - è´§è¿å’Œæ—©ç­å‡†å¤‡
            for (let hour = 3; hour <= 5; hour++) {
                const endMin = hour === 5 ? 30 : 60;
                for (let min = 0; min < endMin; min += 40) {
                    slots.push(hour * 60 + min);
                }
            }
            
            // éšæœºæ‰“ä¹±æ—¶é—´æ®µ
            return slots.sort(() => Math.random() - 0.5);
        }
        
        // è®¡ç®—åˆ°è¾¾æ—¶é—´
        function calculateArrivalTime(departureTime, route) {
            let totalTime = 0;
            
            for (let i = 0; i < route.length - 1; i++) {
                const from = route[i];
                const to = route[i + 1];
                
                // é£è¡Œæ—¶é—´
                if ((from === 'D' && to === 'A') || (from === 'A' && to === 'D')) {
                    totalTime += 90; // 1.5å°æ—¶
                } else {
                    totalTime += 120; // 2å°æ—¶
                }
                
                // èµ·é™æ—¶é—´
                totalTime += 20; // èµ·é£10åˆ†é’Ÿ + é™è½10åˆ†é’Ÿ
                
                // ä¸­è½¬æ—¶é—´ï¼ˆå¦‚æœä¸æ˜¯æœ€åä¸€æ®µï¼‰
                if (i < route.length - 2) {
                    totalTime += 70; // 1å°æ—¶10åˆ†é’Ÿä¸­è½¬
                }
            }
            
            return departureTime + totalTime;
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
        function formatTime(minutes) {
            // å¤„ç†è·¨å¤©çš„æƒ…å†µ
            let totalMinutes = minutes;
            let day = 0;
            
            while (totalMinutes >= 1440) { // 1440 = 24 * 60
                totalMinutes -= 1440;
                day++;
            }
            
            const hours = Math.floor(totalMinutes / 60);
            const mins = totalMinutes % 60;
            const timeStr = `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
            
            if (day > 0) {
                return `${timeStr}+${day}`;
            }
            
            // æ ‡è®°çº¢çœ¼èˆªç­æ—¶é—´æ®µ
            if (hours >= 0 && hours < 6) {
                return `${timeStr} ğŸŒ™`;
            } else if (hours >= 22 || hours < 2) {
                return `${timeStr} ğŸŒƒ`;
            }
            
            return timeStr;
        }
        
        // è·å–å½“å‰æœºåœºçš„èˆªç­
        function getAirportFlights(airport) {
            const now = currentTime;
            return flights.filter(flight => {
                // æ˜¾ç¤ºå³å°†èµ·é£ã€æ­£åœ¨é£è¡Œæˆ–åˆšåˆšåˆ°è¾¾çš„èˆªç­
                const currentLocation = flight.route[flight.currentSegment];
                const nextLocation = flight.route[flight.currentSegment + 1];
                
                return (currentLocation === airport || 
                       (nextLocation === airport && flight.departureTime + flight.delay <= now + 240)) &&
                       flight.departureTime + flight.delay >= now && // æ˜¾ç¤ºç°åœ¨çš„èˆªç­
                       flight.departureTime + flight.delay <= now + 1440; // æ˜¾ç¤ºæœªæ¥16å°æ—¶çš„èˆªç­
            }).sort((a, b) => (a.departureTime + a.delay) - (b.departureTime + b.delay));
        }
        
        // æ›´æ–°èˆªç­æ˜¾ç¤º
        function updateFlightDisplay() {
            ['A', 'B', 'C', 'D'].forEach(airport => {
                const container = document.getElementById(`airport-${airport}`);
                const airportFlights = getAirportFlights(airport);
                
                if (airportFlights.length === 0) {
                    container.innerHTML = '<div class="loading">æš‚æ— èˆªç­ä¿¡æ¯</div>';
                    return;
                }
                
                container.innerHTML = airportFlights.map(flight => {
                    const departureTime = flight.departureTime + flight.delay;
                    const arrivalTime = flight.arrivalTime + flight.delay;
                    const routeDisplay = flight.route.join(' â†’ ');
                    
                    let statusClass = 'status-normal';
                    let statusText = 'æ­£å¸¸';
                    
                    if (flight.delay > 0) {
                        statusClass = 'status-delayed';
                        statusText = `å»¶è¯¯${flight.delay}åˆ†é’Ÿ`;
                    }
                    
                    if (weatherDelays[airport] && weatherDelays[airport].active) {
                        statusClass = 'status-weather';
                        statusText = 'å¤©æ°”å½±å“';
                    }
                    
                    // åˆ†é…ç™»æœºå£
                    if (!flight.gate) {
                        flight.gate = assignGate(airport);
                    }
                    
                    return `
                        <div class="flight-item ${flight.delay > 0 ? 'delayed' : ''}">
                            <div class="flight-number">${flight.flightNumber}</div>
                            <div class="route">èˆªçº¿: ${routeDisplay}</div>
                            <div class="time-info">
                                <span class="departure-time">èµ·é£: ${formatTime(departureTime)}</span>
                                <span class="arrival-time">åˆ°è¾¾: ${formatTime(arrivalTime)}</span>
                            </div>
                            <div style="margin-top: 8px; display: flex; justify-content: space-between; align-items: center;">
                                <span class="gate">ç™»æœºå£ ${flight.gate}</span>
                                <span class="status ${statusClass}">${statusText}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            });
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTimeDisplay() {
            const timeStr = formatTime(currentTime);
            const dayStr = Math.floor(currentTime / 1440) > 0 ? ` (ç¬¬${Math.floor(currentTime / 1440) + 1}å¤©)` : '';
            document.getElementById('currentTime').textContent = `å½“å‰ä»¿çœŸæ—¶é—´: ${timeStr}${dayStr}`;
        }
        
        // å¼€å§‹ä»¿çœŸ
        function startSimulation() {
            if (!isSimulationRunning) {
                isSimulationRunning = true;
                simulationInterval = setInterval(() => {
                    currentTime += 1; // æ¯ç§’å¢åŠ 1åˆ†é’Ÿ
                    updateTimeDisplay();
                    updateFlightDisplay();
                    processWeatherDelays();
                }, 1000);
            }
        }
        
        // æš‚åœä»¿çœŸ
        function pauseSimulation() {
            isSimulationRunning = false;
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }
        }
        
        // é‡ç½®ä»¿çœŸ
        function resetSimulation() {
            pauseSimulation();
            currentTime = 360;
            weatherDelays = {};
            initializeGates();
            createBaseFlights();
            updateTimeDisplay();
            updateFlightDisplay();
        }
        
        // å¤„ç†å¤©æ°”å»¶è¯¯
        function processWeatherDelays() {
            Object.keys(weatherDelays).forEach(airport => {
                const weather = weatherDelays[airport];
                if (weather.active && currentTime >= weather.endTime) {
                    delete weatherDelays[airport];
                }
            });
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showAirModal() {
            document.getElementById('airModal').style.display = 'block';
        }
        
        function showWeatherModal() {
            document.getElementById('weatherModal').style.display = 'block';
        }
        
        function showCompanyModal() {
            const select = document.getElementById('companyFlight');
            select.innerHTML = flights.map(flight => 
                `<option value="${flight.id}">${flight.flightNumber} (${flight.route.join('â†’')})</option>`
            ).join('');
            document.getElementById('companyModal').style.display = 'block';
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // è§¦å‘èˆªè·¯æ‹¥å µ
        function triggerAirCongestion() {
            const airport = document.getElementById('airAirport').value;
            const affectedFlights = flights.filter(flight => 
                flight.route.includes(airport) && flight.departureTime <= currentTime + 30
            );
            
            affectedFlights.forEach((flight, index) => {
                flight.delay += 5; // æ¯æ¶é£æœºå»¶è¯¯5åˆ†é’Ÿé€’å¢
            });
            
            closeModal('airModal');
            updateFlightDisplay();
            alert(`${airport}æœºåœºèˆªè·¯æ‹¥å µå·²è§¦å‘ï¼Œ${affectedFlights.length}ä¸ªèˆªç­å—å½±å“`);
        }
        
        // è§¦å‘å¤©æ°”å¼‚å¸¸
        function triggerWeatherDelay() {
            const airport = document.getElementById('weatherAirport').value;
            
            weatherDelays[airport] = {
                active: true,
                startTime: currentTime,
                endTime: currentTime + 60
            };
            
            // å½±å“ç›¸å…³èˆªç­
            const affectedFlights = flights.filter(flight => 
                flight.route.includes(airport) && 
                flight.departureTime + flight.delay >= currentTime &&
                flight.departureTime + flight.delay <= currentTime + 120
            );
            
            affectedFlights.forEach(flight => {
                flight.delay += 60; // å»¶è¯¯1å°æ—¶
            });
            
            closeModal('weatherModal');
            updateFlightDisplay();
            alert(`${airport}æœºåœºå¤©æ°”å¼‚å¸¸å·²è§¦å‘ï¼Œå½±å“${affectedFlights.length}ä¸ªèˆªç­`);
        }
        
        // è§¦å‘èˆªå¸é—®é¢˜
        function triggerCompanyDelay() {
            const flightId = parseInt(document.getElementById('companyFlight').value);
            const flight = flights.find(f => f.id === flightId);
            
            if (flight) {
                flight.delay += 30; // å»¶è¯¯30åˆ†é’Ÿ
                // é‡æ–°åˆ†é…ç™»æœºå£
                const currentLocation = flight.route[flight.currentSegment];
                flight.gate = assignGate(currentLocation);
            }
            
            closeModal('companyModal');
            updateFlightDisplay();
            alert(`èˆªç­ ${flight.flightNumber} å› èˆªå¸é—®é¢˜å»¶è¯¯30åˆ†é’Ÿ`);
        }
        
        // åˆå§‹åŒ–ç³»ç»Ÿ
        function initializeSystem() {
            initializeGates();
            createBaseFlights();
            updateTimeDisplay();
            updateFlightDisplay();
            
            // å¡«å……èˆªå¸é—®é¢˜é€‰æ‹©æ¡†
            const select = document.getElementById('companyFlight');
            select.innerHTML = flights.map(flight => 
                `<option value="${flight.id}">${flight.flightNumber} (${flight.route.join('â†’')})</option>`
            ).join('');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.addEventListener('load', initializeSystem);
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        window.addEventListener('click', function(event) {
            const modals = ['airModal', 'weatherModal', 'companyModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    closeModal(modalId);
                }
            });
        });
    </script>
</body>
</html>